<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Matrubhoomi</title>

    <!-- FIREBASE -->

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Leckerli+One&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="./css/styles.css" />
  </head>

  <!-- BODY -->

  <body>
    <!-- NAVBAR -->
    <nav
      class="text-center fixed-top"
      style="
        background-color: rgba(255, 255, 255, 0.5);
        padding: 1em;
        /* margin: 0em ; */
        backdrop-filter: blur(2em);
      "
    >
      <div
        style="
          display: flex;
          align-items: center;
          justify-content: space-between;
          flex-wrap: wrap;
        "
      >
        <!-- Left side link -->
        <div>
          <a href="#methods" style="text-decoration: none; color: #000"
            >Methods</a
          >
          <a
            href="#waters"
            style="text-decoration: none; color: #000; margin-left: 0.5em"
            >Waters</a
          >
        </div>
        <!-- Centered brand/logo -->
        <a href=".#" style="text-decoration: none; color: #000; font-size: 24px"
          >matrubhoomi</a
        >
        <a href="#complaint" style="text-decoration: none; color: #000"
          >Register Complaint</a
        >
        <!-- Right side links -->
      </div>
    </nav>
    <div style="height: 3.5em"></div>
    <!-- END NAV -->

    <div class="main-flex">
      <!-- QUOTES -->

      <div class="landing-text text-center leckerli-one-regular">
        <h1 class="text-focus-in" id="quotes">"Placeholder"</h1>
      </div>

      <!-- METHODS -->

      <div class="methods" id="methods">
        <h1 class="pt-2 pb-2">Methods</h1>

        <div class="row p-3">
          <div class="col-md-6 image-container">
            <img
              src="./assets/images/water_sample_collection.jpg"
              class="container-img"
            />
          </div>

          <div class="col-md-6 flex-div p-md-5 p-2">
            <h3>Water Quality Testing</h3>
            <p>
              Get precise water quality testing from us. Using advanced
              equipment, we analyze pH, contaminants, and more for residential,
              commercial, and municipal needs. Trust our expertise for accurate
              results.
            </p>
          </div>
        </div>

        <div class="row p-3">
          <div class="col-md-6 flex-div p-md-5 p-2">
            <h3>River Cleanup</h3>
            <p>
              River Cleanup is a global network organization on a mission to
              clean rivers by empowering people, preventing pollution and
              transforming organizations.With our expert team and tons of
              volunteers excited and eager to cleanup the rivers of our beloved
              country will contribute in this movement with high technology
              machinery contributing in the movement.
            </p>
          </div>
          <div class="col-md-6 image-container">
            <img
              class="container-img"
              alt="River Cleaning"
              src="./assets/images/river_boat.webp"
            />
          </div>

          <div class="row p-3">
            <div class="col-md-6 image-container">
              <img
                class="container-img"
                alt="Sustainable Water Solutions"
                src="./assets/images/water_drop.avif"
              />
            </div>
            <div class="col-md-6 flex-div p-md-5 p-2">
              <h3>Sustainable Water Solutions</h3>
              <p>
                Matrubhoomi Organization presents: Sustainable Water Solutions.
                Join us in our efforts to ensure clean and accessible water for
                all. Together, we're implementing innovative strategies to
                conserve water and promote responsible usage. Let's make a
                difference for our planet and future generations. Get involved
                with Matrubhoomi today!!!
              </p>
            </div>
          </div>

          <div class="row p-3">
            <div class="col-md-6 flex-div p-md-5 p-2">
              <h3>River Cleanup</h3>
              <p>
                River Cleanup is a global network organization on a mission to
                clean rivers by empowering people, preventing pollution and
                transforming organizations.With our expert team and tons of
                volunteers excited and eager to cleanup the rivers of our
                beloved country will contribute in this movement with high
                technology machinery contributing in the movement.
              </p>
            </div>
            <div class="col-md-6 image-container">
              <img
                class="container-img"
                alt="River Cleaning"
                src="./assets/images/river_boat.webp"
              />
            </div>
          </div>

          <div class="row p-3">
            <div class="col-md-6 image-container">
              <img
                class="container-img"
                alt="Eco-friendly Waste Disposal"
                src="./assets/images/gamesh_visargana.png"
              />
            </div>
            <div class="col-md-6 flex-div p-md-5 p-2">
              <h3>Eco-friendly Waste Disposal</h3>
              <p>
                We and our team helps in reducing and avoiding the amount of
                single-use plastic products along with increasing the amount
                recycled at the same time retrieved during the river cleaning
                process.You can deposit the waste into our waste disposal outlet
                too.
              </p>
            </div>
          </div>

          <div class="row p-3">
            <div class="col-md-6 flex-div p-md-5 p-2">
              <h3>Community Awareness Programs</h3>
              <p>
                Welcome to our River Cleanup Community Drive! Join us to protect
                our waterways. Together, we're restoring rivers, reducing
                pollution, and preserving ecosystems. Get involved today
              </p>
            </div>
            <div class="col-md-6 image-container">
              <img
                class="container-img"
                alt="Community Awareness Programs"
                src="./assets/images/pathanatyaa.webp"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- GRAPH -->
      <div class="charts">
        <h1 class="pt-2 pb-2">Complaint Analysis</h1>
        <div id="chart"></div>
      </div>

      <!-- WATERS -->

      <div id="waters">
        <h1 class="pt-2 pb-2">Our Water</h1>
        <div class="carousel carousel-dark slide" id="carousel-140399">
          <ol class="carousel-indicators">
            <li data-slide-to="0" data-target="#carousel-140399"></li>
            <li data-slide-to="1" data-target="#carousel-140399"></li>
            <li
              data-slide-to="2"
              data-target="#carousel-140399"
              class="active"
            ></li>
          </ol>
          <div class="carousel-inner">
            <div class="carousel-item">
              <img
                id="firstCityLink"
                class="d-block w-100"
                alt="Carousel Bootstrap First"
                src="https://www.layoutit.com/img/sports-q-c-1600-500-1.jpg"
              />
              <div class="carousel-caption bg-dark text-white">
                <h2 id="firstCityLabel">First Thumbnail label</h2>
                <p id="firstCityDesc">
                  Cras justo odio, dapibus ac facilisis in, egestas eget quam.
                  Donec id elit non mi porta gravida at eget metus. Nullam id
                  dolor id nibh ultricies vehicula ut id elit.
                </p>
              </div>
            </div>
            <div class="carousel-item active carousel-item-left">
              <img
                id="secondCityLink"
                class="d-block w-100"
                alt="Carousel Bootstrap Second"
                src="https://www.layoutit.com/img/sports-q-c-1600-500-2.jpg"
              />
              <div class="carousel-caption bg-dark text-white">
                <h2 id="secondCityLabel">Second Thumbnail label</h2>
                <p id="secondCityDesc">
                  Cras justo odio, dapibus ac facilisis in, egestas eget quam.
                  Donec id elit non mi porta gravida at eget metus. Nullam id
                  dolor id nibh ultricies vehicula ut id elit.
                </p>
              </div>
            </div>
            <div class="carousel-item carousel-item-next carousel-item-left">
              <img
                id="thirdCityLink"
                class="d-block w-100"
                alt="Carousel Bootstrap Third"
                src="https://www.layoutit.com/img/sports-q-c-1600-500-3.jpg"
              />
              <div class="carousel-caption bg-dark text-white">
                <h2 id="thirdCityLabel">Third Thumbnail label</h2>
                <p id="thirdCityDesc">
                  Cras justo odio, dapibus ac facilisis in, egestas eget quam.
                  Donec id elit non mi porta gravida at eget metus. Nullam id
                  dolor id nibh ultricies vehicula ut id elit.
                </p>
              </div>
            </div>
          </div>
          <a
            class="carousel-control-prev"
            href="#carousel-140399"
            data-slide="prev"
            ><span class="carousel-control-prev-icon"></span>
            <span class="sr-only">Previous</span></a
          >
          <a
            class="carousel-control-next"
            href="#carousel-140399"
            data-slide="next"
            ><span class="carousel-control-next-icon"></span>
            <span class="sr-only">Next</span></a
          >
        </div>
      </div>

      <!-- COMPLAINT FORM -->
      <div id="complaint">
        <h1 class="pt-2 pb-2">Complaint</h1>
        <form action="#" method="post" enctype="multipart/form-data">
          <div class="form-group">
            <label for="email">Email</label>
            <input
              type="email"
              class="form-control"
              id="email"
              name="email"
              required
            />
          </div>
          <div class="form-group">
            <label for="city">City</label>
            <select class="form-control" id="city" name="city" required>
              <option value="">Select City</option>
              <option value="Mumbai">Mumbai</option>
              <option value="Delhi">Delhi</option>
              <option value="Nashik">Nashik</option>
              <option value="Chennai">Chennai</option>
              <option value="Pune">Pune</option>
              <option value="Kolhapur">Kolhapur</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label for="riverName">River Name:</label>
            <input
              type="text"
              class="form-control"
              id="riverName"
              name="riverName"
              required
            />
          </div>
          <div class="form-group">
            <label for="image">Complaint Image</label>
            <input
              type="file"
              class="form-control-file form-control-lg"
              id="riverImage"
              name="image"
              required
            />
          </div>

          <div class="form-group">
            <label for="description">Description:</label>
            <textarea
              class="form-control"
              id="description"
              name="description"
              rows="5"
              required
            ></textarea>
          </div>
          <div
            class="text-center m-auto"
            id="my-submit-btn"
            style="
              background-color: skyblue;
              max-width: 700px;
              padding: 1em;
              border-radius: 2em;
              cursor: pointer;
            "
          >
            <h3>Submit Complaint</h3>
          </div>
        </form>
      </div>

      <!-- Footer -->

      <div class="footer">
        <h4 class="text-center">Footer</h4>
      </div>
    </div>

    <a href="#">
      <div id="goToTopBtn">
        <i class="fa-solid fa-arrow-up fa-2xl"> </i>
      </div>
    </a>

    <!-- BOOTSTRAP -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script
      src="https://kit.fontawesome.com/5522533868.js"
      crossorigin="anonymous"
    ></script>
    <!-- CHART -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <!-- GENERAL -->
    <script src="./scripts/quotes.js"></script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
      import {
        getDatabase,
        child,
        get,
        set,
        ref,
        update,
        remove,
      } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

      import {
        getStorage,
        ref as ref_storage,
        uploadBytesResumable,
        getDownloadURL,
      } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-storage.js";
      const firebaseConfig = {
        apiKey: "AIzaSyAh7afFN2gfCihg6eNskICACMy0eCzr35o",
        authDomain: "te-project-8f9dd.firebaseapp.com",
        databaseURL:
          "https://te-project-8f9dd-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "te-project-8f9dd",
        storageBucket: "te-project-8f9dd.appspot.com",
        messagingSenderId: "412562671967",
        appId: "1:412562671967:web:4fc2c968d030c2073b8eea",
      };

      let firstImgLink, secImgLink, thirdImgLink;
      let firstDesc, secDesc, thirdDesc;
      let firstCity, secCity, thirdCity;
      let itemsCount;

      const app = initializeApp(firebaseConfig);

      const db = getDatabase();

      const storage = getStorage();

      const dbRef = ref(getDatabase());
      get(child(dbRef, `Complaints/`))
        .then((snapshot) => {
          if (snapshot.exists()) {
            let data = snapshot.val();

            // console.log(Object.entries(data).reverse()[0][1].City);

            let citiesNames = [
              "Mumbai",
              "Delhi",
              "Nashik",
              "Chennai",
              "Pune",
              "Kolhapur",
              "Other",
            ];

            let itemsCount = Object.entries(data).length;
            const cityOccurrences = new Array(citiesNames.length).fill(0);
            for (let i = 0; i < itemsCount; i++) {
              const cityName = Object.entries(data)[i][1].City || "Other";
              const cityIndex = citiesNames.indexOf(cityName);
              if (cityIndex !== -1) {
                cityOccurrences[cityIndex]++;
              }
            }
            var options = {
              chart: {
                height: 280,
                type: "area",
              },
              dataLabels: {
                enabled: false,
              },
              series: [
                {
                  name: "Series 1",
                  data: cityOccurrences,
                },
              ],
              fill: {
                type: "gradient",
                gradient: {
                  shadeIntensity: 1,
                  opacityFrom: 0.7,
                  opacityTo: 0.9,
                  stops: [0, 90, 100],
                },
              },
              xaxis: {
                categories: [
                  "Mumbai",
                  "Delhi",
                  "Nashik",
                  "Chennai",
                  "Pune",
                  "Kolhapur",
                  "Other",
                ],
              },
            };

            var chart = new ApexCharts(
              document.querySelector("#chart"),
              options
            );

            chart.render();

            firstCity = Object.entries(data).reverse()[0][1].City;
            secCity = Object.entries(data).reverse()[1][1].City;
            thirdCity = Object.entries(data).reverse()[2][1].City;

            firstDesc = Object.entries(data).reverse()[0][1].Description;
            secDesc = Object.entries(data).reverse()[1][1].Description;
            thirdDesc = Object.entries(data).reverse()[2][1].Description;

            firstImgLink = Object.entries(data).reverse()[0][1].Link;
            secImgLink = Object.entries(data).reverse()[1][1].Link;
            thirdImgLink = Object.entries(data).reverse()[2][1].Link;

            const carousel = document.getElementById("carousel-140399"); // Reference the carousel element
            const imageLinks = [firstImgLink, secImgLink, thirdImgLink];
            const cityLabels = [firstCity, secCity, thirdCity];
            const complaintDesc = [firstDesc, secDesc, thirdDesc];

            function loadCarouselImages() {
              const carouselItems = carousel.querySelectorAll(".carousel-item"); // Get all carousel items

              if (carouselItems.length !== imageLinks.length) {
                console.error(
                  "Number of image links does not match the number of carousel items."
                );
                return; // Exit if there's a mismatch
              }

              carouselItems.forEach((item, index) => {
                const imageElement = item.querySelector("img"); // Get the image element within each item
                imageElement.setAttribute("src", imageLinks[index]); // Set the image source dynamically
              });
            }

            // Call the function after image links are fetched from the API
            loadCarouselImages();

            // Optional: Initialize the carousel after loading images (if needed)
            $(document).ready(function () {
              $("#carousel-140399").carousel({
                // Your desired carousel options here
              });
            });

            document.getElementById(
              "firstCityDesc"
            ).innerHTML = `<p id="firstCityDesc">
                ${firstDesc}
                  </p>`;
            document.getElementById(
              "secondCityDesc"
            ).innerHTML = `<p id="firstCityDesc">
                ${secDesc}
                  </p>`;
            document.getElementById(
              "thirdCityDesc"
            ).innerHTML = `<p id="firstCityDesc">
                ${thirdDesc}
                  </p>`;

            document.getElementById(
              "firstCityLabel"
            ).innerHTML = `<h4 id="firstCityLabel">${firstCity}</h4>`;
            document.getElementById(
              "secondCityLabel"
            ).innerHTML = `<h4 id="firstCityLabel">${secCity}</h4>`;
            document.getElementById(
              "thirdCityLabel"
            ).innerHTML = `<h4 id="firstCityLabel">${thirdCity}</h4>`;
          } else {
            console.log("No data available");
          }
        })
        .catch((error) => {
          console.error(error);
        });

      let city = document.getElementById("city");
      let description = document.getElementById("description");
      let submitButton = document.getElementById("submitButton");
      let email = document.getElementById("email");
      let riverImage = document.getElementById("riverImage");
      let riverName = document.getElementById("riverName");
      let imgURL, chosenFile;

      var today = new Date();
      var dd = String(today.getDate()).padStart(2, "0");
      var mm = String(today.getMonth() + 1).padStart(2, "0"); //January is 0!
      var yyyy = today.getFullYear();
      today = mm + "/" + dd + "/" + yyyy;

      riverImage.addEventListener("change", (event) => {
        chosenFile = event.target.files[0];
      });

      document.getElementById("my-submit-btn").onclick = function () {
        let myEmail = email.value;
        var storageRef = ref_storage(storage, "Images/" + myEmail);
        var uploadTask = uploadBytesResumable(storageRef, chosenFile);
        uploadTask.on(
          "state_changed",
          function (snapshot) {
            console.log(snapshot.bytesTransferred / snapshot.totalBytes) * 100;
          },
          function (error) {
            alert(`Upload Image Failed - ${error}`);
          },

          function () {
            let city = document.getElementById("city");
            let myCity = city.value;
            let description = document.getElementById("description");
            let myDesc = description.value;
            let email = document.getElementById("email");
            let myEmail = email.value;
            let riverName = document.getElementById("riverName");
            let myRiver = riverName.value;
            getDownloadURL(uploadTask.snapshot.ref)
              .then((downloadURL) => {
                console.log("File available at", downloadURL);
                imgURL = downloadURL;

                const dateTime = new Date().toLocaleString("en-US", {
                  year: "numeric",
                  month: "2-digit",
                  day: "2-digit",
                  hour: "2-digit",
                  minute: "2-digit",
                  second: "2-digit",
                });
                let myDateTime = dateTime.replace(/\D/g, "");

                set(ref(db, "Complaints/" + myDateTime), {
                  Email: myEmail,
                  City: myCity,
                  RiverName: myRiver,
                  Description: myDesc,
                  Link: imgURL,
                  Date: today,
                });
                alert("Complain Successfully Submitted");
              })
              .catch((error) => {
                alert(`Something went wrong ${error}`);
              });
          }
        );
      };
    </script>
  </body>
</html>
